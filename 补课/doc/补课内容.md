# 补课内容


## 2019-7-23

### 纲要
* 路由守卫（路由钩子函数），
* 路由拦截，
* vue的动态路由、嵌套路由、生命周期各个时期能做什么功能，怎么理解,
* 编程式路由传参,
* token，


### 路由守卫
* 什么是路由：跳转
* 什么是路由守卫：跳转过程执行的生命周期函数（钩子函数）
* 路由守卫的使用场景
    * 路由拦截（需要登录才可访问的页面）
* 分类
    * 全局守卫
        * 写在配置文件中，对所有路由进行拦截
        * beforeEach()
        * afterEach()
    * 路由独享的守卫
        * 写在具体某个路由配置中,一般针对某个特定路由拦截
        * beforeEnter
    * 组件内的守卫
        * beforeRouteEnter
        * beforeRouteUpdate (一般用于动态路由)
        * beforeRouteLeave
    ```js
        //router.js
        import Vue from 'vue';
        import VueRouter from 'vue-router';
        Vue.use(VueRouter);

        let router = new VueRouter({
            // 配置文件
            routes:[{
                path:'/home',
                component:Home
            },
            {
                path:'/list',
                component:List
                children:[{
                    path:'/phone',
                    component:Phone
                },{
                    path:'/pad',
                    component:Pad,
                    meta:{
                        requiresAuth:true
                    }
                }]
            },
            {
                path:'/cart',
                component:Cart,
                // 针对某个特定路由拦截
                beforeEnter(to,from,next){

                },
                meta:{
                    requiresAuth:true
                }
            },{
                path:'/mine',
                component:Mine,
                meta:{
                    requiresAuth:true
                }
            }]
        })

        // 全局守卫
        // 任何的路由跳转都会进入全局路由守卫
        router.beforeEach(function(to,from,next){
            // 先判断目标路由是否需要登录权限
            // if(to.meta.requiresAuth){
            if(to.matched.some(item=>item.meta.requiresAuth)){// [{'/list'},{'/list/pad'}]
                // 有条件地执行next
                // 登录：放行
                // 未登录：跳到登录页面
                let token = localStorage.getItem('Authorization');
                if(token){
                    next()
                }else{
                    next({
                        path:'/login',
                        query:{
                            redirectTo:to.fullPath // 为了登录成功后跳转目标路由(获取方式：this.$route.query.redirectTo)
                        }
                    })
                }
            }else{
                next()
            }
        })

        export default routers;
    ```

* 动态路由
    * 监听动态路由的切换
        * watch ： this.$route
        ```js
            {
                watch:{
                    // 能监听实例中所有的属性
                    $route:function(to,from){

                    }
                }
            }
        ```
```js
    new VueRouter({
        routes:[
            {
                path:'/goods/:id',
                component:Goods
            }
        ]
    })

    // /goods/123 -> /goods/246

```

* 编程式路由传参
    * 定义时传参
        * props
    * 跳转时传参
        * query 
        * params （刷新消失）